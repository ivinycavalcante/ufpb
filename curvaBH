import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# ğŸ“„ Ler arquivo CSV
caminho_arquivo = r"D:\UsuÃ¡rio\iviny\Downloads\scope_0.csv"
dados = pd.read_csv(caminho_arquivo, sep=',', decimal='.')
dados.columns = dados.columns.str.strip()

# ğŸ” Verificar colunas
print("Nomes das colunas:", dados.columns)
print(dados.head())

# ğŸ§¹ ConversÃ£o de dados
dados['x'] = pd.to_numeric(dados['x'], errors='coerce')
dados['canal1'] = pd.to_numeric(dados['canal1'], errors='coerce')
dados['canal2'] = pd.to_numeric(dados['canal2'], errors='coerce')

# ğŸ”¥ Remover linhas com NaN (ruÃ­do de captura)
dados = dados.dropna()

# ğŸ§  Remover offset automaticamente
offset_canal1 = dados['canal1'].mean()
offset_canal2 = dados['canal2'].mean()

dados['canal1_corrigido'] = dados['canal1'] - offset_canal1
dados['canal2_corrigido'] = dados['canal2'] - offset_canal2

# âš™ï¸ Constantes do sistema
N = 50                 # NÃºmero de espiras
R_shunt = 1            # Ohm (resistor shunt)
l_m = 0.069            # m (comprimento mÃ©dio do nÃºcleo)
A = 0.000201           # mÂ² (Ã¡rea da seÃ§Ã£o transversal do nÃºcleo)
R = 10000              # Ohm (resistor do integrador)
C = 1e-6               # F (capacitor do integrador)

# âš¡ CÃ¡lculo de H e B (com unidades fÃ­sicas)
dados['H'] = (N * dados['canal1_corrigido']) / (R_shunt * l_m)  # A/m
dados['B'] = dados['canal2_corrigido'] / (R * C * N * A)        # Tesla

# ğŸ“Š Plot da curva B-H calibrada
plt.figure(figsize=(10,6))
plt.plot(dados['H'], dados['B'], color='darkblue', linewidth=1.5)

plt.title('Curva B-H', fontsize=14)
plt.xlabel('H [A/m]', fontsize=12)
plt.ylabel('B [T]', fontsize=12)
plt.grid(True)
plt.tight_layout()
plt.show()

